/** layui-v2.5.5 MIT License By https://www.layui.com */
 ;layui.define(["layer","laytpl"],function(e){"use strict";var t=layui.$,a=layui.layer,i=layui.laytpl,n=layui.hint(),o=layui.device(),l={config:{},set:function(e){var a=this;return a.config=t.extend({},a.config,e),a},on:function(e,t){return layui.onevent.call(this,c,e,t)}},r=function(){var e=this;return{upload:function(t){e.upload.call(e,t)},reload:function(t){e.reload.call(e,t)},config:e.config}},c="upload",s="layui-upload-file",u="layui-upload-form",f="layui-upload-iframe",p="layui-upload-choose",d=function(e){var a=this;console.log(e),a.config=t.extend({},a.config,l.config,e),a.render()};d.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1,uploaddisplay:{serverUrl:"",id:"",deleteBtnId:""}},d.prototype.render=function(e){var a=this,e=a.config;e.elem=t(e.elem),e.bindAction=t(e.bindAction),a.file(),a.events()},d.prototype.file=function(){var e=this,a=e.config,i=e.elemFile=t(['<input class="'+s+'" type="file" accept="'+a.acceptMime+'" name="'+a.field+'"',a.multiple?" multiple":"",">"].join("")),n=a.elem.next();(n.hasClass(s)||n.hasClass(u))&&n.remove(),o.ie&&o.ie<10&&a.elem.wrap('<div class="layui-upload-wrap"></div>'),e.isFile()?(e.elemFile=a.elem,a.field=a.elem[0].name):a.elem.after(i),o.ie&&o.ie<10&&e.initIE()},d.prototype.initIE=function(){var e=this,a=e.config,i=t('<iframe id="'+f+'" class="'+f+'" name="'+f+'" frameborder="0"></iframe>'),n=t(['<form target="'+f+'" class="'+u+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+a.url+'">',"</form>"].join(""));t("#"+f)[0]||t("body").append(i),a.elem.next().hasClass(u)||(e.elemFile.wrap(n),a.elem.next("."+u).append(function(){var e=[];return layui.each(a.data,function(t,a){a="function"==typeof a?a():a,e.push('<input type="hidden" name="'+t+'" value="'+a+'">')}),e.join("")}()))},d.prototype.msg=function(e){return a.msg(e,{icon:2,shift:6})},d.prototype.isFile=function(){var e=this.config.elem[0];if(e)return"input"===e.tagName.toLocaleLowerCase()&&"file"===e.type},d.prototype.preview=function(e){var t=this;window.FileReader&&layui.each(t.chooseFiles,function(t,a){var i=new FileReader;i.readAsDataURL(a),i.onload=function(){e&&e(t,a,this.result)}})},d.prototype.upload=function(e,a){var n=this,l=n.config,r=n.elemFile[0],c=function(){var a=0,i=0,o=e||n.files||n.chooseFiles||r.files,c=function(){l.multiple&&a+i===n.fileLength&&"function"==typeof l.allDone&&l.allDone({total:n.fileLength,successful:a,aborted:i})};layui.each(o,function(e,o){var r=new FormData;r.append(l.field,o),layui.each(l.data,function(e,t){t="function"==typeof t?t():t,r.append(e,t)}),void 0!==l.fileId&&void 0!==l.serverUrl&&(l.saveUrl=l.url,l.url=l.serverUrl),t.ajax({url:l.url,type:"post",data:r,contentType:!1,processData:!1,dataType:"json",headers:l.headers||{},success:function(t){a++,u(e,t),void 0!==l.urlCallback&&v(e,t),c()},error:function(){i++,n.msg("请求上传接口出现异常"),error(e),c()},xhr:function(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);"function"==typeof l.progress&&l.progress(t,e)}}),e}})})},s=function(){var e=t("#"+f);n.elemFile.parent().submit(),clearInterval(d.timer),d.timer=setInterval(function(){var t,a=e.contents().find("body");try{t=a.text()}catch(i){n.msg("获取上传后的响应信息出现异常"),clearInterval(d.timer),error()}t&&(clearInterval(d.timer),a.html(""),u(0,t))},30)},u=function(e,t){if(n.elemFile.next("."+p).remove(),r.value="","object"!=typeof t)try{t=JSON.parse(t)}catch(a){return t={},n.msg("请对上传接口返回有效JSON")}"function"==typeof l.done&&l.done(t,e||0,function(e){n.upload(e)})},v=function(e,a){if(n.elemFile.next("."+p).remove(),r.value="","object"!=typeof a)try{a=JSON.parse(a)}catch(o){return a={},n.msg("请对上传接口返回有效JSON")}t.ajax({url:l.serverUrl+"?fileId="+a.data,type:"get",contentType:!1,processData:!1,headers:l.headers||{},success:function(e){if(0===e.code){a.serverUrl=e,t("#fileNameEchoDisplay").remove(),t(l.deleteBtnId).unbind("click"),value=0===value.length?r.value.match(/[^\/\\]+\..+/g)||[]||"":value;var n=String(value);n=n.substring(n.length-4,n.length+1).replace(".",""),/(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif)$/i.test(n)&&(n="img");var o={icon:n,url:e.data.url,name:String(value)},c='<span style="display:block;margin:5px;transition:height 0.5s ease,margin 0.5s ;" id="fileNameEchoDisplay"><svg class="icon" aria-hidden="true" style="font-size:16px;"><use xlink:href="#icon-{{=  d.icon}}"></use></svg><a href="{{= d.url}}" target="_blank">{{=  d.name}}</a></span>';i(c).render(o,function(e){console.log(l.elem.parent()),l.elem.before(e),m()})}},error:function(){n.msg("请求上传接口出现异常"),error(e)}}),"function"==typeof l.urlCallback&&l.urlCallback(a,e||0,function(e){n.upload(e)})},m=function(){t(l.deleteBtnId).unbind("click"),t(l.deleteBtnId).on("click",function(){var e=t("#fileNameEchoDisplay");e.removeClass(""),e.addClass("layui-anim-fadeout"),e.on("animationend",function(){e.css({height:"0",margin:"0"})}),e.on("transitionend",function(){e.remove()}),"function"==typeof l.deleteEchoDisplay&&l.deleteEchoDisplay(function(e){})})};if(error=function(e){l.auto&&(r.value=""),"function"==typeof l.error&&l.error(e||0,function(e){n.upload(e)})},exts=l.exts,check,value=function(){var t=[];return layui.each(e||n.chooseFiles,function(e,a){t.push(a.name)}),t}(),args={preview:function(e){n.preview(e)},upload:function(e,t){var a={};a[e]=t,n.upload(a)},pushFile:function(){return n.files=n.files||{},layui.each(n.chooseFiles,function(e,t){n.files[e]=t}),n.files},resetFile:function(e,t,a){var i=new File([t],a);n.files=n.files||{},n.files[e]=i}},send=function(){if("choose"!==a&&!l.auto||(l.choose&&l.choose(args),"choose"!==a))return l.before&&l.before(args),o.ie?o.ie>9?c():s():void c()},value=0===value.length?r.value.match(/[^\/\\]+\..+/g)||[]||"":value,0!==value.length){switch(l.accept){case"file":if(exts&&!RegExp("\\w\\.("+exts+")$","i").test(escape(value)))return n.msg("选择的文件中包含不支持的格式"),r.value="";break;case"video":if(!RegExp("\\w\\.("+(exts||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(value)))return n.msg("选择的视频中包含不支持的格式"),r.value="";break;case"audio":if(!RegExp("\\w\\.("+(exts||"mp3|wav|mid")+")$","i").test(escape(value)))return n.msg("选择的音频中包含不支持的格式"),r.value="";break;case"pdf":if(!RegExp("\\w\\.("+(exts||"pdf")+")$","i").test(escape(value)))return n.msg("选择的文件不为pdf"),r.value="";break;default:if(layui.each(value,function(e,t){RegExp("\\w\\.("+(exts||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(t))||(check=!0)}),check)return n.msg("选择的图片中包含不支持的格式"),r.value=""}switch(l.accept){case"file":exts&&!RegExp("\\w\\.("+exts+")$","i").test(escape(value))||(l.data.scourceType=0);break;case"video":RegExp("\\w\\.("+(exts||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(value))&&(l.data.scourceType=2);break;case"audio":RegExp("\\w\\.("+(exts||"mp3|wav|mid")+")$","i").test(escape(value))&&(l.data.scourceType=2);break;case"pdf":RegExp("\\w\\.("+(exts||"pdf")+")$","i").test(escape(value))&&(l.data.scourceType=3);break;default:layui.each(value,function(e,t){RegExp("\\w\\.("+(exts||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(t))&&(check=!0)}),check&&(l.data.scourceType=1)}if(n.fileLength=function(){var t=0,a=e||n.files||n.chooseFiles||r.files;return layui.each(a,function(){t++}),t}(),l.number&&n.fileLength>l.number)return n.msg("同时最多只能上传的数量为："+l.number);if(l.size>0&&!(o.ie&&o.ie<10)){var g;if(layui.each(n.chooseFiles,function(e,t){if(t.size>1024*l.size){var a=l.size/1024;a=a>=1?a.toFixed(2)+"MB":l.size+"KB",r.value="",g=a}}),g)return n.msg("文件不能超过"+g)}send(),m()}},d.prototype.reload=function(e){e=e||{},delete e.elem,delete e.bindAction;var a=this,e=a.config=t.extend({},a.config,l.config,e),i=e.elem.next();i.attr({name:e.name,accept:e.acceptMime,multiple:e.multiple})},d.prototype.events=function(){var e=this,a=e.config,i=function(t){e.chooseFiles={},layui.each(t,function(t,a){var i=(new Date).getTime();e.chooseFiles[i+"-"+t]=a})},l=function(t,i){var n=e.elemFile,o=t.length>1?t.length+"个文件":(t[0]||{}).name||n[0].value.match(/[^\/\\]+\..+/g)||[]||"";n.next().hasClass(p)&&n.next().remove(),e.upload(null,"choose"),e.isFile()||a.choose||n.after('<span class="layui-inline '+p+'">'+o+"</span>")};a.elem.off("upload.start").on("upload.start",function(){var i=t(this),o=i.attr("lay-data");if(o)try{o=new Function("return "+o)(),e.config=t.extend({},a,o)}catch(l){n.error("Upload element property lay-data configuration item has a syntax error: "+o)}e.config.item=i,e.elemFile[0].click()}),o.ie&&o.ie<10||a.elem.off("upload.over").on("upload.over",function(){var e=t(this);e.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var e=t(this);e.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(n,o){var r=t(this),c=o.originalEvent.dataTransfer.files||[];r.removeAttr("lay-over"),i(c),a.auto?e.upload(c):l(c)}),e.elemFile.off("upload.change").on("upload.change",function(){var t=this.files||[];i(t),a.auto?e.upload():l(t)}),a.bindAction.off("upload.action").on("upload.action",function(){e.upload()}),a.elem.data("haveEvents")||(e.elemFile.on("change",function(){t(this).trigger("upload.change")}),a.elem.on("click",function(){e.isFile()||t(this).trigger("upload.start")}),a.drag&&a.elem.on("dragover",function(e){e.preventDefault(),t(this).trigger("upload.over")}).on("dragleave",function(e){t(this).trigger("upload.leave")}).on("drop",function(e){e.preventDefault(),t(this).trigger("upload.drop",e)}),a.bindAction.on("click",function(){t(this).trigger("upload.action")}),a.elem.data("haveEvents",!0))},l.render=function(e){var t=new d(e);return r.call(t)},e(c,l)});