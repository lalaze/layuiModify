/** layui-v2.5.5 MIT License By https://www.layui.com */
 ;layui.define(["layer","laytpl"],function(e){"use strict";var t=layui.$,i=layui.layer,a=layui.laytpl,n=layui.hint(),o=layui.device(),l={config:{},set:function(e){var i=this;return i.config=t.extend({},i.config,e),i},on:function(e,t){return layui.onevent.call(this,c,e,t)}},r=function(){var e=this;return{upload:function(t){e.upload.call(e,t)},reload:function(t){e.reload.call(e,t)},config:e.config}},c="upload",u="layui-upload-file",s="layui-upload-form",f="layui-upload-iframe",p="layui-upload-choose",d=function(e){var i=this;i.config=t.extend({},i.config,l.config,e),i.render()};d.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1},d.prototype.render=function(e){var i=this,e=i.config;e.elem=t(e.elem),e.bindAction=t(e.bindAction),i.file(),i.events()},d.prototype.file=function(){var e=this,i=e.config,a=e.elemFile=t(['<input class="'+u+'" type="file" accept="'+i.acceptMime+'" name="'+i.field+'"',i.multiple?" multiple":"",">"].join("")),n=i.elem.next();(n.hasClass(u)||n.hasClass(s))&&n.remove(),o.ie&&o.ie<10&&i.elem.wrap('<div class="layui-upload-wrap"></div>'),e.isFile()?(e.elemFile=i.elem,i.field=i.elem[0].name):i.elem.after(a),o.ie&&o.ie<10&&e.initIE()},d.prototype.initIE=function(){var e=this,i=e.config,a=t('<iframe id="'+f+'" class="'+f+'" name="'+f+'" frameborder="0"></iframe>'),n=t(['<form target="'+f+'" class="'+s+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+i.url+'">',"</form>"].join(""));t("#"+f)[0]||t("body").append(a),i.elem.next().hasClass(s)||(e.elemFile.wrap(n),i.elem.next("."+s).append(function(){var e=[];return layui.each(i.data,function(t,i){i="function"==typeof i?i():i,e.push('<input type="hidden" name="'+t+'" value="'+i+'">')}),e.join("")}()))},d.prototype.msg=function(e){return i.msg(e,{icon:2,shift:6})},d.prototype.isFile=function(){var e=this.config.elem[0];if(e)return"input"===e.tagName.toLocaleLowerCase()&&"file"===e.type},d.prototype.preview=function(e){var t=this;window.FileReader&&layui.each(t.chooseFiles,function(t,i){var a=new FileReader;a.readAsDataURL(i),a.onload=function(){e&&e(t,i,this.result)}})},d.prototype.upload=function(e,i){var n,l=this,r=l.config,c=l.elemFile[0],u=function(){var i=0,a=0,n=e||l.files||l.chooseFiles||c.files,o=function(){r.multiple&&i+a===l.fileLength&&"function"==typeof r.allDone&&r.allDone({total:l.fileLength,successful:i,aborted:a})};layui.each(n,function(e,n){var c=new FormData;c.append(r.field,n),layui.each(r.data,function(e,t){t="function"==typeof t?t():t,c.append(e,t)}),void 0!==r.fileId&&void 0!==r.serverUrl&&(console.log("进来了"),r.saveUrl=r.url,r.url=r.serverUrl),t.ajax({url:r.url,type:"post",data:c,contentType:!1,processData:!1,dataType:"json",headers:r.headers||{},success:function(t){i++,m(e,t),void 0!==r.urlCallback&&g(e,t),o()},error:function(){a++,l.msg("请求上传接口出现异常"),h(e),o()},xhr:function(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);"function"==typeof r.progress&&r.progress(t,e)}}),e}})})},s=function(){var e=t("#"+f);l.elemFile.parent().submit(),clearInterval(d.timer),d.timer=setInterval(function(){var t,i=e.contents().find("body");try{t=i.text()}catch(a){l.msg("获取上传后的响应信息出现异常"),clearInterval(d.timer),h()}t&&(clearInterval(d.timer),i.html(""),m(0,t))},30)},m=function(e,t){if(l.elemFile.next("."+p).remove(),c.value="","object"!=typeof t)try{t=JSON.parse(t)}catch(i){return t={},l.msg("请对上传接口返回有效JSON")}"function"==typeof r.done&&r.done(t,e||0,function(e){l.upload(e)})},g=function(e,i){if(l.elemFile.next("."+p).remove(),c.value="","object"!=typeof i)try{i=JSON.parse(i)}catch(n){return i={},l.msg("请对上传接口返回有效JSON")}t.ajax({url:r.serverUrl+"?fileId="+i.data,type:"get",contentType:!1,processData:!1,headers:r.headers||{},success:function(e){if(0===e.code){i.serverUrl=e,t("#fileNameEchoDisplay").remove(),t(r.deleteBtnId).unbind("click"),b=0===b.length?c.value.match(/[^\/\\]+\..+/g)||[]||"":b;var n=String(b);n=n.substring(n.length-4,n.length+1).replace(".",""),/(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif)$/i.test(n)&&(n="img");var o={icon:n,url:e.data.url,name:String(b)},l='<span style="display:block;margin:5px;" id="fileNameEchoDisplay"><svg class="icon" aria-hidden="true" style="font-size:16px;"><use xlink:href="#icon-{{=  d.icon}}"></use></svg><a href="{{= d.url}}" target="_blank">{{=  d.name}}</a></span>';a(l).render(o,function(e){r.elem.before(e),v()})}},error:function(){l.msg("请求上传接口出现异常"),h(e)}}),"function"==typeof r.urlCallback&&r.urlCallback(i,e||0,function(e){l.upload(e)})},v=function(){t(r.deleteBtnId).unbind("click"),t(r.deleteBtnId).on("click",function(){t("#fileNameEchoDisplay").remove(),"function"==typeof r.deleteEchoDisplay&&r.deleteEchoDisplay(function(e){})})},h=function(e){r.auto&&(c.value=""),"function"==typeof r.error&&r.error(e||0,function(e){l.upload(e)})},y=r.exts,b=function(){var t=[];return layui.each(e||l.chooseFiles,function(e,i){t.push(i.name)}),t}(),w={preview:function(e){l.preview(e)},upload:function(e,t){var i={};i[e]=t,l.upload(i)},pushFile:function(){return l.files=l.files||{},layui.each(l.chooseFiles,function(e,t){l.files[e]=t}),l.files},resetFile:function(e,t,i){var a=new File([t],i);l.files=l.files||{},l.files[e]=a}},x=function(){if("choose"!==i&&!r.auto||(r.choose&&r.choose(w),"choose"!==i))return r.before&&r.before(w),o.ie?o.ie>9?u():s():void u()};if(b=0===b.length?c.value.match(/[^\/\\]+\..+/g)||[]||"":b,0!==b.length){switch(r.accept){case"file":if(y&&!RegExp("\\w\\.("+y+")$","i").test(escape(b)))return l.msg("选择的文件中包含不支持的格式"),c.value="";break;case"video":if(!RegExp("\\w\\.("+(y||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(b)))return l.msg("选择的视频中包含不支持的格式"),c.value="";break;case"audio":if(!RegExp("\\w\\.("+(y||"mp3|wav|mid")+")$","i").test(escape(b)))return l.msg("选择的音频中包含不支持的格式"),c.value="";break;case"pdf":if(!RegExp("\\w\\.("+(y||"pdf")+")$","i").test(escape(b)))return l.msg("选择的文件不为pdf"),c.value="";break;default:if(layui.each(b,function(e,t){RegExp("\\w\\.("+(y||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(t))||(n=!0)}),n)return l.msg("选择的图片中包含不支持的格式"),c.value=""}switch(r.accept){case"file":y&&!RegExp("\\w\\.("+y+")$","i").test(escape(b))||(r.data.scourceType=0);break;case"video":RegExp("\\w\\.("+(y||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(b))&&(r.data.scourceType=2);break;case"audio":RegExp("\\w\\.("+(y||"mp3|wav|mid")+")$","i").test(escape(b))&&(r.data.scourceType=2);break;case"pdf":RegExp("\\w\\.("+(y||"pdf")+")$","i").test(escape(b))&&(r.data.scourceType=3);break;default:layui.each(b,function(e,t){RegExp("\\w\\.("+(y||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(t))&&(n=!0)}),n&&(r.data.scourceType=1)}if(console.log(r),l.fileLength=function(){var t=0,i=e||l.files||l.chooseFiles||c.files;return layui.each(i,function(){t++}),t}(),r.number&&l.fileLength>r.number)return l.msg("同时最多只能上传的数量为："+r.number);if(r.size>0&&!(o.ie&&o.ie<10)){var F;if(layui.each(l.chooseFiles,function(e,t){if(t.size>1024*r.size){var i=r.size/1024;i=i>=1?i.toFixed(2)+"MB":r.size+"KB",c.value="",F=i}}),F)return l.msg("文件不能超过"+F)}x(),v()}},d.prototype.reload=function(e){e=e||{},delete e.elem,delete e.bindAction;var i=this,e=i.config=t.extend({},i.config,l.config,e),a=e.elem.next();a.attr({name:e.name,accept:e.acceptMime,multiple:e.multiple})},d.prototype.events=function(){var e=this,i=e.config,a=function(t){e.chooseFiles={},layui.each(t,function(t,i){var a=(new Date).getTime();e.chooseFiles[a+"-"+t]=i})},l=function(t,a){var n=e.elemFile,o=t.length>1?t.length+"个文件":(t[0]||{}).name||n[0].value.match(/[^\/\\]+\..+/g)||[]||"";n.next().hasClass(p)&&n.next().remove(),e.upload(null,"choose"),e.isFile()||i.choose||n.after('<span class="layui-inline '+p+'">'+o+"</span>")};i.elem.off("upload.start").on("upload.start",function(){var a=t(this),o=a.attr("lay-data");if(o)try{o=new Function("return "+o)(),e.config=t.extend({},i,o)}catch(l){n.error("Upload element property lay-data configuration item has a syntax error: "+o)}e.config.item=a,e.elemFile[0].click()}),o.ie&&o.ie<10||i.elem.off("upload.over").on("upload.over",function(){var e=t(this);e.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var e=t(this);e.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(n,o){var r=t(this),c=o.originalEvent.dataTransfer.files||[];r.removeAttr("lay-over"),a(c),i.auto?e.upload(c):l(c)}),e.elemFile.off("upload.change").on("upload.change",function(){var t=this.files||[];a(t),i.auto?e.upload():l(t)}),i.bindAction.off("upload.action").on("upload.action",function(){e.upload()}),i.elem.data("haveEvents")||(e.elemFile.on("change",function(){t(this).trigger("upload.change")}),i.elem.on("click",function(){e.isFile()||t(this).trigger("upload.start")}),i.drag&&i.elem.on("dragover",function(e){e.preventDefault(),t(this).trigger("upload.over")}).on("dragleave",function(e){t(this).trigger("upload.leave")}).on("drop",function(e){e.preventDefault(),t(this).trigger("upload.drop",e)}),i.bindAction.on("click",function(){t(this).trigger("upload.action")}),i.elem.data("haveEvents",!0))},l.render=function(e){var t=new d(e);return r.call(t)},e(c,l)});