/** layui-v2.5.5 MIT License By https://www.layui.com */
 ;"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return"undefined"==typeof e?"undefined":_typeof(e)}):function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":_typeof(e)}))(e)}layui.define(["layer","laytpl"],function(e){var t=layui.$,n=layui.layer,i=layui.laytpl,o=layui.hint(),a=layui.device(),r={config:{},set:function(e){var n=this;return n.config=t.extend({},n.config,e),n},on:function(e,t){return layui.onevent.call(this,c,e,t)}},l=function(){var e=this;return{upload:function(t){e.upload.call(e,t)},reload:function(t){e.reload.call(e,t)},config:e.config}},c="upload",u="layui-upload-file",f="layui-upload-form",s="layui-upload-iframe",p="layui-upload-choose",d=function(e){var n=this;n.config=t.extend({},n.config,r.config,e),n.render()};d.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1},d.prototype.render=function(e){var n=this,e=n.config;e.elem=t(e.elem),e.bindAction=t(e.bindAction),n.file(),n.events()},d.prototype.file=function(){var e=this,n=e.config,i=e.elemFile=t(['<input class="'+u+'" type="file" accept="'+n.acceptMime+'" name="'+n.field+'"',n.multiple?" multiple":"",">"].join("")),o=n.elem.next();(o.hasClass(u)||o.hasClass(f))&&o.remove(),a.ie&&a.ie<10&&n.elem.wrap('<div class="layui-upload-wrap"></div>'),e.isFile()?(e.elemFile=n.elem,n.field=n.elem[0].name):n.elem.after(i),a.ie&&a.ie<10&&e.initIE()},d.prototype.initIE=function(){var e=this,n=e.config,i=t('<iframe id="'+s+'" class="'+s+'" name="'+s+'" frameborder="0"></iframe>'),o=t(['<form target="'+s+'" class="'+f+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+n.url+'">',"</form>"].join(""));t("#"+s)[0]||t("body").append(i),n.elem.next().hasClass(f)||(e.elemFile.wrap(o),n.elem.next("."+f).append(function(){var e=[];return layui.each(n.data,function(t,n){n="function"==typeof n?n():n,e.push('<input type="hidden" name="'+t+'" value="'+n+'">')}),e.join("")}()))},d.prototype.msg=function(e){return n.msg(e,{icon:2,shift:6})},d.prototype.isFile=function(){var e=this.config.elem[0];if(e)return"input"===e.tagName.toLocaleLowerCase()&&"file"===e.type},d.prototype.preview=function(e){var t=this;window.FileReader&&layui.each(t.chooseFiles,function(t,n){var i=new FileReader;i.readAsDataURL(n),i.onload=function(){e&&e(t,n,this.result)}})},d.prototype.upload=function(e,n){var o,r=this,l=r.config,c=r.elemFile[0],u=function(){var n=0,i=0,o=e||r.files||r.chooseFiles||c.files,a=function(){l.multiple&&n+i===r.fileLength&&"function"==typeof l.allDone&&l.allDone({total:r.fileLength,successful:n,aborted:i})};layui.each(o,function(e,o){var c=new FormData;c.append(l.field,o),layui.each(l.data,function(e,t){t="function"==typeof t?t():t,c.append(e,t)}),void 0!==l.fileId&&void 0!==l.serverUrl&&(console.log("进来了"),l.saveUrl=l.url,l.url=l.serverUrl),t.ajax({url:l.url,type:"post",data:c,contentType:!1,processData:!1,dataType:"json",headers:l.headers||{},success:function(t){n++,m(e,t),void 0!==l.urlCallback&&g(e,t),a()},error:function(){i++,r.msg("请求上传接口出现异常"),h(e),a()},xhr:function u(){var u=new XMLHttpRequest;return u.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);"function"==typeof l.progress&&l.progress(t,e)}}),u}})})},f=function(){var e=t("#"+s);r.elemFile.parent().submit(),clearInterval(d.timer),d.timer=setInterval(function(){var t,n=e.contents().find("body");try{t=n.text()}catch(i){r.msg("获取上传后的响应信息出现异常"),clearInterval(d.timer),h()}t&&(clearInterval(d.timer),n.html(""),m(0,t))},30)},m=function(e,t){if(r.elemFile.next("."+p).remove(),c.value="","object"!==("undefined"==typeof t?"undefined":_typeof(t)))try{t=JSON.parse(t)}catch(n){return t={},r.msg("请对上传接口返回有效JSON")}"function"==typeof l.done&&l.done(t,e||0,function(e){r.upload(e)})},g=function(e,n){if(r.elemFile.next("."+p).remove(),c.value="","object"!==("undefined"==typeof n?"undefined":_typeof(n)))try{n=JSON.parse(n)}catch(o){return n={},r.msg("请对上传接口返回有效JSON")}t.ajax({url:l.serverUrl+"?fileId="+n.data,type:"get",contentType:!1,processData:!1,headers:l.headers||{},success:function(e){if(0===e.code){n.serverUrl=e,t("#fileNameEchoDisplay").remove(),t(l.deleteBtnId).unbind("click"),b=0===b.length?c.value.match(/[^\/\\]+\..+/g)||[]||"":b;var o=String(b);o=o.substring(o.length-4,o.length+1).replace(".",""),/(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif)$/i.test(o)&&(o="img");var a={icon:o,url:e.data.url,name:String(b)},r='<span style="display:block;margin:5px;" id="fileNameEchoDisplay"><svg class="icon" aria-hidden="true" style="font-size:16px;"><use xlink:href="#icon-{{=  d.icon}}"></use></svg><a href="{{= d.url}}" target="_blank">{{=  d.name}}</a></span>';i(r).render(a,function(e){l.elem.before(e),v()})}},error:function(){r.msg("请求上传接口出现异常"),h(e)}}),"function"==typeof l.urlCallback&&l.urlCallback(n,e||0,function(e){r.upload(e)})},v=function(){t(l.deleteBtnId).unbind("click"),t(l.deleteBtnId).on("click",function(){t("#fileNameEchoDisplay").remove(),"function"==typeof l.deleteEchoDisplay&&l.deleteEchoDisplay(function(e){})})},h=function(e){l.auto&&(c.value=""),"function"==typeof l.error&&l.error(e||0,function(e){r.upload(e)})},y=l.exts,b=function(){var t=[];return layui.each(e||r.chooseFiles,function(e,n){t.push(n.name)}),t}(),w={preview:function(e){r.preview(e)},upload:function(e,t){var n={};n[e]=t,r.upload(n)},pushFile:function(){return r.files=r.files||{},layui.each(r.chooseFiles,function(e,t){r.files[e]=t}),r.files},resetFile:function(e,t,n){var i=new File([t],n);r.files=r.files||{},r.files[e]=i}},x=function(){if("choose"!==n&&!l.auto||(l.choose&&l.choose(w),"choose"!==n))return l.before&&l.before(w),a.ie?a.ie>9?u():f():void u()};if(b=0===b.length?c.value.match(/[^\/\\]+\..+/g)||[]||"":b,0!==b.length){switch(l.accept){case"file":if(y&&!RegExp("\\w\\.("+y+")$","i").test(escape(b)))return r.msg("选择的文件中包含不支持的格式"),c.value="";break;case"video":if(!RegExp("\\w\\.("+(y||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(b)))return r.msg("选择的视频中包含不支持的格式"),c.value="";break;case"audio":if(!RegExp("\\w\\.("+(y||"mp3|wav|mid")+")$","i").test(escape(b)))return r.msg("选择的音频中包含不支持的格式"),c.value="";break;case"pdf":if(!RegExp("\\w\\.("+(y||"pdf")+")$","i").test(escape(b)))return r.msg("选择的文件不为pdf"),c.value="";break;default:if(layui.each(b,function(e,t){RegExp("\\w\\.("+(y||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(t))||(o=!0)}),o)return r.msg("选择的图片中包含不支持的格式"),c.value=""}switch(l.accept){case"file":y&&!RegExp("\\w\\.("+y+")$","i").test(escape(b))||(l.data.scourceType=0);break;case"video":RegExp("\\w\\.("+(y||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(b))&&(l.data.scourceType=2);break;case"audio":RegExp("\\w\\.("+(y||"mp3|wav|mid")+")$","i").test(escape(b))&&(l.data.scourceType=2);break;case"pdf":RegExp("\\w\\.("+(y||"pdf")+")$","i").test(escape(b))&&(l.data.scourceType=3);break;default:layui.each(b,function(e,t){RegExp("\\w\\.("+(y||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(t))&&(o=!0)}),o&&(l.data.scourceType=1)}if(console.log(l),r.fileLength=function(){var t=0,n=e||r.files||r.chooseFiles||c.files;return layui.each(n,function(){t++}),t}(),l.number&&r.fileLength>l.number)return r.msg("同时最多只能上传的数量为："+l.number);if(l.size>0&&!(a.ie&&a.ie<10)){var F;if(layui.each(r.chooseFiles,function(e,t){if(t.size>1024*l.size){var n=l.size/1024;n=n>=1?n.toFixed(2)+"MB":l.size+"KB",c.value="",F=n}}),F)return r.msg("文件不能超过"+F)}x(),v()}},d.prototype.reload=function(e){e=e||{},delete e.elem,delete e.bindAction;var n=this,e=n.config=t.extend({},n.config,r.config,e),i=e.elem.next();i.attr({name:e.name,accept:e.acceptMime,multiple:e.multiple})},d.prototype.events=function(){var e=this,n=e.config,i=function(t){e.chooseFiles={},layui.each(t,function(t,n){var i=(new Date).getTime();e.chooseFiles[i+"-"+t]=n})},r=function(t,i){var o=e.elemFile,a=t.length>1?t.length+"个文件":(t[0]||{}).name||o[0].value.match(/[^\/\\]+\..+/g)||[]||"";o.next().hasClass(p)&&o.next().remove(),e.upload(null,"choose"),e.isFile()||n.choose||o.after('<span class="layui-inline '+p+'">'+a+"</span>")};n.elem.off("upload.start").on("upload.start",function(){var i=t(this),a=i.attr("lay-data");if(a)try{a=new Function("return "+a)(),e.config=t.extend({},n,a)}catch(r){o.error("Upload element property lay-data configuration item has a syntax error: "+a)}e.config.item=i,e.elemFile[0].click()}),a.ie&&a.ie<10||n.elem.off("upload.over").on("upload.over",function(){var e=t(this);e.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var e=t(this);e.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(o,a){var l=t(this),c=a.originalEvent.dataTransfer.files||[];l.removeAttr("lay-over"),i(c),n.auto?e.upload(c):r(c)}),e.elemFile.off("upload.change").on("upload.change",function(){var t=this.files||[];i(t),n.auto?e.upload():r(t)}),n.bindAction.off("upload.action").on("upload.action",function(){e.upload()}),n.elem.data("haveEvents")||(e.elemFile.on("change",function(){t(this).trigger("upload.change")}),n.elem.on("click",function(){e.isFile()||t(this).trigger("upload.start")}),n.drag&&n.elem.on("dragover",function(e){e.preventDefault(),t(this).trigger("upload.over")}).on("dragleave",function(e){t(this).trigger("upload.leave")}).on("drop",function(e){e.preventDefault(),t(this).trigger("upload.drop",e)}),n.bindAction.on("click",function(){t(this).trigger("upload.action")}),n.elem.data("haveEvents",!0))},r.render=function(e){var t=new d(e);return l.call(t)},e(c,r)});