/** layui-v2.5.5 MIT License By https://www.layui.com */
 ;layui.define(["layer","laytpl"],function(e){"use strict";var a=layui.$,i=layui.layer,t=layui.laytpl,n=layui.hint(),o=layui.device(),l={config:{},set:function(e){var i=this;return i.config=a.extend({},i.config,e),i},on:function(e,a){return layui.onevent.call(this,c,e,a)}},r=function(){var e=this;return{upload:function(a){e.upload.call(e,a)},reload:function(a){e.reload.call(e,a)},config:e.config}},c="upload",s="layui-upload-file",u="layui-upload-form",p="layui-upload-iframe",f="layui-upload-choose",d=function(e){var i=this;i.config=a.extend({},i.config,l.config,e),i.render();var t=!(!e.uploaddisplay.fileId||!e.uploaddisplay.serverUrl);e.uploaddisplay.fileId&&t&&i.displayCall()};d.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1,uploaddisplay:{serverUrl:"",fileId:"",deleteBtnId:""}},d.prototype.render=function(e){var i=this,e=i.config;e.elem=a(e.elem),e.bindAction=a(e.bindAction),i.file(),i.events()},d.prototype.displayCall=function(e){var i=this,e=i.config;e.elem=a(e.elem),i.ajaxUrl()},d.prototype.ajaxUrl=function(e,i){var n=this,e=n.config;e.elem=a(e.elem),i=i?i:e.uploaddisplay.fileId,a.ajax({url:e.uploaddisplay.serverUrl+"?fileId="+i,type:"get",contentType:!1,processData:!1,headers:e.headers||{},success:function(a){if(0===a.code){var i=String(a.data.name);i=i.substring(i.length-4,i.length+1).replace(".",""),/(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif)$/i.test(i)&&(i="img");var o={icon:i,url:a.data.url,name:String(a.data.name)},l=(new Date).getTime(),r='<span class="layui-anim-fadein" style="display:block;margin:5px;transition:height 0.5s ease,margin 0.5s ;" id="fileNameEchoDisplay'+l+'"><svg class="icon" aria-hidden="true" style="font-size:16px;"><use xlink:href="#icon-{{=  d.icon}}"></use></svg><a href="{{= d.url}}" target="_blank">{{=  d.name}}</a></span>';t(r).render(o,function(i){e.elem.before(i),e.uploaddisplay.deleteBtnId&&n.deleteEchoDisplay(e,l),"function"==typeof e.uploaddisplay.urlCallback&&e.uploaddisplay.urlCallback(a)})}},error:function(){n.msg("请求上传接口出现异常"),error(index)}})},d.prototype.deleteEchoDisplay=function(e,i){var t=this,e=t.config;e.elem=a(e.elem),a(e.uploaddisplay.deleteBtnId).unbind("click"),a(e.uploaddisplay.deleteBtnId).on("click",function(){var t=a("#fileNameEchoDisplay"+i);t.removeClass("layui-anim-fadein"),t.addClass("layui-anim-fadeout"),t.on("animationend",function(){t.css({height:"0",margin:"0"})}),t.on("transitionend",function(){t.remove()}),"function"==typeof e.uploaddisplay.deleteEchoDisplay&&e.uploaddisplay.deleteEchoDisplay(function(e){})})},d.prototype.file=function(){var e=this,i=e.config,t=e.elemFile=a(['<input class="'+s+'" type="file" accept="'+i.acceptMime+'" name="'+i.field+'"',i.multiple?" multiple":"",">"].join("")),n=i.elem.next();(n.hasClass(s)||n.hasClass(u))&&n.remove(),o.ie&&o.ie<10&&i.elem.wrap('<div class="layui-upload-wrap"></div>'),e.isFile()?(e.elemFile=i.elem,i.field=i.elem[0].name):i.elem.after(t),o.ie&&o.ie<10&&e.initIE()},d.prototype.initIE=function(){var e=this,i=e.config,t=a('<iframe id="'+p+'" class="'+p+'" name="'+p+'" frameborder="0"></iframe>'),n=a(['<form target="'+p+'" class="'+u+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+i.url+'">',"</form>"].join(""));a("#"+p)[0]||a("body").append(t),i.elem.next().hasClass(u)||(e.elemFile.wrap(n),i.elem.next("."+u).append(function(){var e=[];return layui.each(i.data,function(a,i){i="function"==typeof i?i():i,e.push('<input type="hidden" name="'+a+'" value="'+i+'">')}),e.join("")}()))},d.prototype.msg=function(e){return i.msg(e,{icon:2,shift:6})},d.prototype.isFile=function(){var e=this.config.elem[0];if(e)return"input"===e.tagName.toLocaleLowerCase()&&"file"===e.type},d.prototype.preview=function(e){var a=this;window.FileReader&&layui.each(a.chooseFiles,function(a,i){var t=new FileReader;t.readAsDataURL(i),t.onload=function(){e&&e(a,i,this.result)}})},d.prototype.upload=function(e,i){var t,n=this,l=n.config,r=n.elemFile[0],c=function(){var i=0,t=0,o=e||n.files||n.chooseFiles||r.files,c=function(){l.multiple&&i+t===n.fileLength&&"function"==typeof l.allDone&&l.allDone({total:n.fileLength,successful:i,aborted:t})};layui.each(o,function(e,o){var r=new FormData;r.append(l.field,o),layui.each(l.data,function(e,a){a="function"==typeof a?a():a,r.append(e,a)}),a.ajax({url:l.url,type:"post",data:r,contentType:!1,processData:!1,dataType:"json",headers:l.headers||{},success:function(a){i++,u(e,a),l.uploaddisplay.serverUrl&&m(e,a),c()},error:function(){t++,n.msg("请求上传接口出现异常"),g(e),c()},xhr:function(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=Math.floor(e.loaded/e.total*100);"function"==typeof l.progress&&l.progress(a,e)}}),e}})})},s=function(){var e=a("#"+p);n.elemFile.parent().submit(),clearInterval(d.timer),d.timer=setInterval(function(){var a,i=e.contents().find("body");try{a=i.text()}catch(t){n.msg("获取上传后的响应信息出现异常"),clearInterval(d.timer),g()}a&&(clearInterval(d.timer),i.html(""),u(0,a))},30)},u=function(e,a){if(n.elemFile.next("."+f).remove(),r.value="","object"!=typeof a)try{a=JSON.parse(a)}catch(i){return a={},n.msg("请对上传接口返回有效JSON")}"function"==typeof l.done&&l.done(a,e||0,function(e){n.upload(e)})},m=function(e,a){if(n.elemFile.next("."+f).remove(),r.value="","object"!=typeof a)try{a=JSON.parse(a)}catch(i){return a={},n.msg("请对上传接口返回有效JSON")}0===a.code&&(n.ajaxUrl(l,a.data),"function"==typeof l.uploaddisplay.idCallback&&l.uploaddisplay.idCallback(a,function(e){}))},g=function(e){l.auto&&(r.value=""),"function"==typeof l.error&&l.error(e||0,function(e){n.upload(e)})},h=l.exts,v=function(){var a=[];return layui.each(e||n.chooseFiles,function(e,i){a.push(i.name)}),a}(),y={preview:function(e){n.preview(e)},upload:function(e,a){var i={};i[e]=a,n.upload(i)},pushFile:function(){return n.files=n.files||{},layui.each(n.chooseFiles,function(e,a){n.files[e]=a}),n.files},resetFile:function(e,a,i){var t=new File([a],i);n.files=n.files||{},n.files[e]=t}},b=function(){if("choose"!==i&&!l.auto||(l.choose&&l.choose(y),"choose"!==i))return l.before&&l.before(y),o.ie?o.ie>9?c():s():void c()};if(v=0===v.length?r.value.match(/[^\/\\]+\..+/g)||[]||"":v,0!==v.length){switch(l.accept){case"file":if(h&&!RegExp("\\w\\.("+h+")$","i").test(escape(v)))return n.msg("选择的文件中包含不支持的格式"),r.value="";break;case"video":if(!RegExp("\\w\\.("+(h||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(v)))return n.msg("选择的视频中包含不支持的格式"),r.value="";break;case"audio":if(!RegExp("\\w\\.("+(h||"mp3|wav|mid")+")$","i").test(escape(v)))return n.msg("选择的音频中包含不支持的格式"),r.value="";break;case"pdf":if(!RegExp("\\w\\.("+(h||"pdf")+")$","i").test(escape(v)))return n.msg("选择的文件不为pdf"),r.value="";break;default:if(layui.each(v,function(e,a){RegExp("\\w\\.("+(h||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(a))||(t=!0)}),t)return n.msg("选择的图片中包含不支持的格式"),r.value=""}switch(l.accept){case"file":h&&!RegExp("\\w\\.("+h+")$","i").test(escape(v))||(l.data.scourceType=0);break;case"video":RegExp("\\w\\.("+(h||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(v))&&(l.data.scourceType=2);break;case"audio":RegExp("\\w\\.("+(h||"mp3|wav|mid")+")$","i").test(escape(v))&&(l.data.scourceType=2);break;case"pdf":RegExp("\\w\\.("+(h||"pdf")+")$","i").test(escape(v))&&(l.data.scourceType=3);break;default:layui.each(v,function(e,a){RegExp("\\w\\.("+(h||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(a))&&(t=!0)}),t&&(l.data.scourceType=1)}if(n.fileLength=function(){var a=0,i=e||n.files||n.chooseFiles||r.files;return layui.each(i,function(){a++}),a}(),l.number&&n.fileLength>l.number)return n.msg("同时最多只能上传的数量为："+l.number);if(l.size>0&&!(o.ie&&o.ie<10)){var x;if(layui.each(n.chooseFiles,function(e,a){if(a.size>1024*l.size){var i=l.size/1024;i=i>=1?i.toFixed(2)+"MB":l.size+"KB",r.value="",x=i}}),x)return n.msg("文件不能超过"+x)}b()}},d.prototype.reload=function(e){e=e||{},delete e.elem,delete e.bindAction;var i=this,e=i.config=a.extend({},i.config,l.config,e),t=e.elem.next();t.attr({name:e.name,accept:e.acceptMime,multiple:e.multiple})},d.prototype.events=function(){var e=this,i=e.config,t=function(a){e.chooseFiles={},layui.each(a,function(a,i){var t=(new Date).getTime();e.chooseFiles[t+"-"+a]=i})},l=function(a,t){var n=e.elemFile,o=a.length>1?a.length+"个文件":(a[0]||{}).name||n[0].value.match(/[^\/\\]+\..+/g)||[]||"";n.next().hasClass(f)&&n.next().remove(),e.upload(null,"choose"),e.isFile()||i.choose||n.after('<span class="layui-inline '+f+'">'+o+"</span>")};i.elem.off("upload.start").on("upload.start",function(){var t=a(this),o=t.attr("lay-data");if(o)try{o=new Function("return "+o)(),e.config=a.extend({},i,o)}catch(l){n.error("Upload element property lay-data configuration item has a syntax error: "+o)}e.config.item=t,e.elemFile[0].click()}),o.ie&&o.ie<10||i.elem.off("upload.over").on("upload.over",function(){var e=a(this);e.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var e=a(this);e.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(n,o){var r=a(this),c=o.originalEvent.dataTransfer.files||[];r.removeAttr("lay-over"),t(c),i.auto?e.upload(c):l(c)}),e.elemFile.off("upload.change").on("upload.change",function(){var a=this.files||[];t(a),i.auto?e.upload():l(a)}),i.bindAction.off("upload.action").on("upload.action",function(){e.upload()}),i.elem.data("haveEvents")||(e.elemFile.on("change",function(){a(this).trigger("upload.change")}),i.elem.on("click",function(){e.isFile()||a(this).trigger("upload.start")}),i.drag&&i.elem.on("dragover",function(e){e.preventDefault(),a(this).trigger("upload.over")}).on("dragleave",function(e){a(this).trigger("upload.leave")}).on("drop",function(e){e.preventDefault(),a(this).trigger("upload.drop",e)}),i.bindAction.on("click",function(){a(this).trigger("upload.action")}),i.elem.data("haveEvents",!0))},l.render=function(e){var a=new d(e);return r.call(a)},e(c,l)});