/** layui-v2.5.5 MIT License By https://www.layui.com */
 ;layui.define(["jquery","laydate","upload","layer"],function(a){var e=layui.$,t=layui.laydate,d=layui.upload,l=layui.layer;dataTable={cache:{},index:{},Render:{date:{},upload:{},radio:{},checkbox:{}}},WRITE_RENDERDATA=function(a,e,t,d,l,r){l?(dataTable.Render[e][a]||(dataTable.Render[e][a]={}),dataTable.Render[e][a][t]?(dataTable.Render[e][a][t].data.push(t+"-"+d),dataTable.Render[e][a][t].index=dataTable.Render[e][a][t].index+1):(dataTable.Render[e][a][t]={},dataTable.Render[e][a][t].data=[],dataTable.Render[e][a][t].index=0,dataTable.Render[e][a][t].data.push(t+"-"+d),r&&(dataTable.Render[e][a][t].valueList=r))):dataTable.Render[e][a][t].index=dataTable.Render[e][a][t].index+1},TEMPLATE_OBJECT=function(a){var e={};e.namelist=[];for(var t=0;t<a.length;t++)a[t].edit?e[a[t].field]={edit:!0}:a[t].date?e[a[t].field]={date:!0}:a[t].upload?e[a[t].field]={upload:!0}:a[t].radio?(e[a[t].field]={radio:!0},a[t].data?e[a[t].field].data=a[t].data:MSG("使用下拉选择请导入数据")):a[t].checkbox&&(e[a[t].field]={checkbox:!0},a[t].data?e[a[t].field].data=a[t].data:MSG("使用下拉选择请导入数据")),e.namelist.push(a[t].field);return e},TABLE_HEAD=function(a){var e=["<colgroup>",function(){for(var e="",t=0;t<a.length;t++)e+=a[t].width?'<col width="'+a[t].width+'">':"<col>";return e}(),'<col width="10%"></col>',"</colgroup>","<tr>",function(){for(var e="",t=0;t<a.length;t++)e+="<th>"+a[t].title+"</th>";return e}(),"<th>操作</th>","</tr>"].join("");return e},TABLE_BODY=function(a,e,t){if(a){if("[object Array]"!=Object.prototype.toString.call(a))return MSG("数据格式错误"),"";if("[object Object]"!=Object.prototype.toString.call(a[0]))return MSG("数据格式错误"),"";for(var d="",l=TEMPLATE_OBJECT(e),r=0;r<a.length;r++){d+='<tr id="'+t+"-"+r+'">';for(var n=0;n<l.namelist.length;n++)d+=TABLE_TEMPLATE(t,l,l.namelist[n],r,a[r]);d+='<td><button type="button" class="layui-btn layui-btn-xs layui-btn-danger" tableId="delete" style="margin:0;">删除</button></td>',d+="</tr>",dataTable.index[t]=r}return d}},TABLE_ONE=function(a,e,t){var d="",l=TEMPLATE_OBJECT(e);dataTable.index[t]=dataTable.index[t]+1,d+='<tr id="'+t+"-"+dataTable.index[t]+'">';for(var r=0;r<l.namelist.length;r++)d+=TABLE_TEMPLATE(t,l,l.namelist[r],dataTable.index[t],"");return d+='<td><button type="button" class="layui-btn layui-btn-xs layui-btn-danger  tableId="delete" style="margin:0;">删除</button></td>',d+="</tr>"},TABLE_TEMPLATE=function(a,e,t,d,l){return e[t]?1==e[t].edit?'<td contentEditable="true" tableId="'+t+'">'+(l[t]?l[t]:"")+"</td>":1==e[t].date?l?(WRITE_RENDERDATA(a,"date",t,d,!0),'<td style="padding:0;" tableId="'+t+'"><input style="border:none;" type="text" class="layui-input" value="" id="'+t+"-"+d+'" autocomplete="off"></input></td>'):(WRITE_RENDERDATA(a,"date",t,d,!1),'<td style="padding:0;" tableId="'+t+'"><input style="border:none;" type="text" class="layui-input" value="" id="'+t+"-"+dataTable.Render.date[a][t].index+'" autocomplete="off"></input></td>'):1==e[t].upload?l?(WRITE_RENDERDATA(a,"upload",t,d,!0),'<td  tableId="'+t+'"><button id="'+t+"-"+d+'" class="layui-btn layui-btn-xs" type="button" style="margin:0;display: inline-block;">上传</button> </td>'):(WRITE_RENDERDATA(a,"upload",t,d,!1),'<td  tableId="'+t+'"><button id="'+t+"-"+dataTable.Render.upload[a][t].index+'" class="layui-btn layui-btn-xs" type="button" style="margin:0;display: inline-block;">上传</button> </td>'):1==e[t].radio?l?(WRITE_RENDERDATA(a,"radio",t,d,!0,e[t].data),'<td style="padding:0;" tableId = "'+t+'" id="'+t+"-"+d+'"></td>'):(WRITE_RENDERDATA(a,"radio",t,d,!1),'<td style="padding:0;" tableId = "'+t+'" id="'+t+"-"+dataTable.Render.radio[a][t].index+'"></td>'):1==e[t].checkbox?l?(WRITE_RENDERDATA(a,"checkbox",t,d,!0,e[t].data),'<td style="padding:0;" tableId = "'+t+'" id="'+t+"-"+d+'"></td>'):(WRITE_RENDERDATA(a,"checkbox",t,d,!1),'<td style="padding:0;" tableId = "'+t+'" id="'+t+"-"+dataTable.Render.checkbox[a][t].index+'"></td>'):void 0:'<td tableId="'+t+'">'+(l[t]?l[t]:"")+"</td>"},TABLE_ALL=function(a){return result=' <table class="layui-table" style="width:'+a.width+'">'+TABLE_HEAD(a.cols)+TABLE_BODY(a.data,a.cols,a.elem.replace("#",""))+"</table>"},AJAX=function(a){var t;return e.ajax({url:a,type:"get",async:!1,success:function(a){t=a.data},error:function(){MSG("数据接口出现异常")}}),t},MSG=function(a){return l.msg(a,{icon:2,shift:6})},Class=function(a){var e=this;e.config=a,a.url&&(a.data=AJAX(a.url)),dataTable.cache[a.elem.replace("#","")]=a.data,dataTable.cache.show=a.data,e.render(a.elem,TABLE_ALL(a)),e.add(a),e.deleteAndEdit(a.elem)},Class.prototype.render=function(a,t){var d=this;e(a).append(t),dataTable.Render.date[a.replace("#","")]&&d.dateRender(a.replace("#",""),!1),dataTable.Render.upload[a.replace("#","")]&&d.uploadRender(a.replace("#",""),!1),dataTable.Render.radio[a.replace("#","")]&&d.radioRender(a.replace("#",""),!1,"radio"),dataTable.Render.checkbox[a.replace("#","")]&&d.radioRender(a.replace("#",""),!1,"checkbox")},Class.prototype.dateRender=function(a,d){if(d===!1)for(var l in dataTable.Render.date[a])for(var r=0;r<dataTable.Render.date[a][l].data.length;r++){var n=e("#"+dataTable.Render.date[a][l].data[r]).parent().parent().attr("id").split("-")[1],i=dataTable.cache[a][n][l];t.render({elem:"#"+dataTable.Render.date[a][l].data[r],trigger:"click",value:i?new Date(Number(i)):0})}else if(d)for(var l in dataTable.Render.date[a])t.render({elem:"#"+dataTable.Render.date[a][l].data[0].split("-")[0]+"-"+dataTable.Render.date[a][l].index,trigger:"click"})},Class.prototype.uploadRender=function(a,t){var l=this;if(t)for(var r in dataTable.Render.upload[a])d.render({elem:"#"+dataTable.Render.upload[a][r].data[0].split("-")[0]+"-"+dataTable.Render.upload[a][r].index,url:l.config.upload.url,data:{bucketName:l.config.upload.bucketName},uploaddisplay:{serverUrl:l.config.upload.serverUrl,idCallback:function(e,t){var d=t.parent().parent().attr("id").split("-")[1],l=t.parent().attr("tableId");dataTable.cache[a][d][l]=e.data,dataTable.cache.show=dataTable.cache[a]},urlCallback:function(a,e){e.prev().find("a")[0].innerText=a.data.contentType}}});else for(var r in dataTable.Render.upload[a])for(var n=0;n<dataTable.Render.upload[a][r].data.length;n++){var i=e("#"+dataTable.Render.upload[a][r].data[n]).parent().parent().attr("id").split("-")[1],c=dataTable.cache[a][i][r];d.render({elem:"#"+dataTable.Render.upload[a][r].data[n],url:l.config.upload.url,data:{bucketName:l.config.upload.bucketName},uploaddisplay:{serverUrl:l.config.upload.serverUrl,fileId:c,idCallback:function(e,t){var d=t.parent().parent().attr("id").split("-")[1],l=t.parent().attr("tableId");dataTable.cache[a][d][l]=e.data,dataTable.cache.show=dataTable.cache[a]},urlCallback:function(a,e){e.prev().find("a")[0].innerText=a.data.contentType}}})}},Class.prototype.radioRender=function(a,t,d){if(!xmSelect)return void MSG("使用下拉选择请导入xmSelect");if(t)for(var l in dataTable.Render[d][a])var r=xmSelect.render({el:"#"+dataTable.Render[d][a][l].data[0].split("-")[0]+"-"+dataTable.Render[d][a][l].index,radio:"radio"===d,style:{height:"100%",border:"none"},model:{label:{type:"xxxx",xxxx:{template:function(a,e){return'<div style="color: green;">已选中</div>'}}}},on:function(t){var r=e("#"+dataTable.Render[d][a][l].data[0].split("-")[0]+"-"+dataTable.Render[d][a][l].index).parent().attr("id").split("-")[1],n=e("#"+dataTable.Render[d][a][l].data[0].split("-")[0]+"-"+dataTable.Render[d][a][l].index).attr("tableId"),i=[];t.arr.forEach(function(a){i.push(a.value)}),dataTable.cache[a][r][n]=i,dataTable.cache.show=dataTable.cache[a]},autoRow:!0,data:dataTable.Render[d][a][l].valueList});else for(var l in dataTable.Render[d][a])e.each(dataTable.Render[d][a][l].data,function(t){var r=xmSelect.render({el:"#"+dataTable.Render[d][a][l].data[t],radio:"radio"===d,style:{height:"100%",border:"none"},model:{label:{type:"xxxx",xxxx:{template:function(a,e){return'<div style="color: green;">已选中</div>'}}}},on:function(r){var n=e("#"+dataTable.Render[d][a][l].data[t]).parent().attr("id").split("-")[1],i=e("#"+dataTable.Render[d][a][l].data[t]).attr("tableId"),c=[];r.arr.forEach(function(a){c.push(a.value)}),dataTable.cache[a][n][i]=c,dataTable.cache.show=dataTable.cache[a]},autoRow:!0,data:dataTable.Render[d][a][l].valueList}),n=e("#"+dataTable.Render[d][a][l].data[t]).parent().attr("id").split("-")[1],i=dataTable.cache[a][n][l];i&&(i=i.split(",")),i&&r.setValue(i)})},Class.prototype.add=function(a){var t=this;a.add&&e(a.add).bind("click",function(){var d=TABLE_ONE(a.data,a.cols,a.elem.replace("#",""));e(a.elem+" table").append(d),dataTable.Render.date[a.elem.replace("#","")]&&t.dateRender(a.elem.replace("#",""),!0),dataTable.Render.upload[a.elem.replace("#","")]&&t.uploadRender(a.elem.replace("#",""),!0),dataTable.Render.radio[a.elem.replace("#","")]&&t.radioRender(a.elem.replace("#",""),!0,"radio"),dataTable.Render.checkbox[a.elem.replace("#","")]&&t.radioRender(a.elem.replace("#",""),!0,"checkbox"),dataTable.cache[a.elem.replace("#","")][dataTable.index[[a.elem.replace("#","")]]]={},dataTable.cache.show=dataTable.cache[a.elem.replace("#","")]})},Class.prototype.deleteAndEdit=function(a){e(a).on("click",'button[tableId="delete"]',function(){var t=e(this).parent().parent().attr("id").split("-")[1];dataTable.cache[a.replace("#","")].splice(t,1),dataTable.cache.show=dataTable.cache[a.replace("#","")],e(this).parent().parent().remove(),dataTable.index[a.replace("#","")]=dataTable.index[a.replace("#","")]-1,e(a+" table tbody tr[id]").each(function(t){e(this).attr("id",a.replace("#","")+"-"+t)})}),e(a).on("blur","td",function(t){if("td"===t.target.nodeName.toLowerCase()){var d=e(this).parent().attr("id").split("-")[1],l=e(this).attr("tableId");dataTable.cache[a.replace("#","")][d][l]=e(this).text(),dataTable.cache.show=dataTable.cache[a.replace("#","")]}if("input"===t.target.nodeName.toLowerCase()){var d=e(this).parent().attr("id").split("-")[1],l=e(this).attr("tableId"),r=e(this).children(":first").attr("id");setTimeout(function(){lay("#"+r).each(function(e,t){dataTable.cache[a.replace("#","")][d][l]=t.value,dataTable.cache.show=dataTable.cache[a.replace("#","")]})},100)}})},dataTable.render=function(a){var e=new Class(a);return e},a("dataTable",dataTable)});